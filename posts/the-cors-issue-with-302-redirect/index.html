<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>302跳转的跨域问题(CORS) | 流动</title><meta name=keywords content="cors"><meta name=description content="302跳转的跨域问题
场景一：302不返回跨域头
请求
GET /302 HTTP/1.1
Host: liudon.xyz
Origin: https://www.baidu.com
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36
返回
HTTP/1.1 200 OK
Cache-Control: private, max-age=0, no-store, no-cache, must-revalidate, post-check=0, pre-check=0
Cf-Ray: 88535773eaf5107e-HKG
Content-Length: 143
Content-Type: text/html
Date: Fri, 17 May 2024 11:42:00 GMT
Expires: Thu, 01 Jan 1970 00:00:01 GMT
Location: https://liudon.org
Server: cloudflare
Vary: Accept-Encoding
浏览器报错"><meta name=author content="Liudon"><link rel=canonical href=https://liudon.com/posts/the-cors-issue-with-302-redirect/><link crossorigin=anonymous href=../../assets/css/stylesheet.c2b4102602461aaea01497bf2f89d3d4096e9005f6ac8a7e60b27e335724b916.css integrity="sha256-wrQQJgJGGq6gFJe/L4nT1AlukAX2rIp+YLJ+M1ckuRY=" rel="preload stylesheet" as=style><link rel=icon href=https://liudon.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://liudon.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://liudon.com/favicon-32x32.png><link rel=apple-touch-icon href=https://liudon.com/apple-touch-icon.png><link rel=mask-icon href=https://liudon.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://liudon.com/posts/the-cors-issue-with-302-redirect/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta name=google-site-verification content="rJrwFlRtYvRvSMxmD-zlGY6ozg6aDFMkfavno3ms5Ew"><meta name=google-adsense-account content="ca-pub-4739645989170648"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4739645989170648" crossorigin=anonymous></script><meta property="og:url" content="https://liudon.com/posts/the-cors-issue-with-302-redirect/"><meta property="og:site_name" content="流动"><meta property="og:title" content="302跳转的跨域问题(CORS)"><meta property="og:description" content="302跳转的跨域问题
场景一：302不返回跨域头 请求
GET /302 HTTP/1.1 Host: liudon.xyz Origin: https://www.baidu.com User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36 返回
HTTP/1.1 200 OK Cache-Control: private, max-age=0, no-store, no-cache, must-revalidate, post-check=0, pre-check=0 Cf-Ray: 88535773eaf5107e-HKG Content-Length: 143 Content-Type: text/html Date: Fri, 17 May 2024 11:42:00 GMT Expires: Thu, 01 Jan 1970 00:00:01 GMT Location: https://liudon.org Server: cloudflare Vary: Accept-Encoding 浏览器报错"><meta property="og:locale" content="zh-cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-05-17T20:13:57+08:00"><meta property="article:modified_time" content="2024-05-17T20:13:57+08:00"><meta property="article:tag" content="Cors"><meta name=twitter:card content="summary"><meta name=twitter:title content="302跳转的跨域问题(CORS)"><meta name=twitter:description content="302跳转的跨域问题
场景一：302不返回跨域头
请求
GET /302 HTTP/1.1
Host: liudon.xyz
Origin: https://www.baidu.com
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36
返回
HTTP/1.1 200 OK
Cache-Control: private, max-age=0, no-store, no-cache, must-revalidate, post-check=0, pre-check=0
Cf-Ray: 88535773eaf5107e-HKG
Content-Length: 143
Content-Type: text/html
Date: Fri, 17 May 2024 11:42:00 GMT
Expires: Thu, 01 Jan 1970 00:00:01 GMT
Location: https://liudon.org
Server: cloudflare
Vary: Accept-Encoding
浏览器报错"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"文章","item":"https://liudon.com/posts/"},{"@type":"ListItem","position":2,"name":"302跳转的跨域问题(CORS)","item":"https://liudon.com/posts/the-cors-issue-with-302-redirect/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"302跳转的跨域问题(CORS)","name":"302跳转的跨域问题(CORS)","description":"302跳转的跨域问题\n场景一：302不返回跨域头 请求\nGET /302 HTTP/1.1 Host: liudon.xyz Origin: https://www.baidu.com User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36 返回\nHTTP/1.1 200 OK Cache-Control: private, max-age=0, no-store, no-cache, must-revalidate, post-check=0, pre-check=0 Cf-Ray: 88535773eaf5107e-HKG Content-Length: 143 Content-Type: text/html Date: Fri, 17 May 2024 11:42:00 GMT Expires: Thu, 01 Jan 1970 00:00:01 GMT Location: https://liudon.org Server: cloudflare Vary: Accept-Encoding 浏览器报错\n","keywords":["cors"],"articleBody":"302跳转的跨域问题\n场景一：302不返回跨域头 请求\nGET /302 HTTP/1.1 Host: liudon.xyz Origin: https://www.baidu.com User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36 返回\nHTTP/1.1 200 OK Cache-Control: private, max-age=0, no-store, no-cache, must-revalidate, post-check=0, pre-check=0 Cf-Ray: 88535773eaf5107e-HKG Content-Length: 143 Content-Type: text/html Date: Fri, 17 May 2024 11:42:00 GMT Expires: Thu, 01 Jan 1970 00:00:01 GMT Location: https://liudon.org Server: cloudflare Vary: Accept-Encoding 浏览器报错\nAccess to fetch at 'https://liudon.xyz/302' from origin 'https://www.baidu.com' has been blocked by CORS policy: No 'Access-Control-Allow-Origin' header is present on the requested resource. If an opaque response serves your needs, set the request's mode to 'no-cors' to fetch the resource with CORS disabled. 场景二：302跳转返回跨域头 请求\nGET /302_return_origin_header HTTP/1.1 Host: liudon.xyz Origin: https://www.baidu.com User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36 返回\nHTTP/1.1 200 OK Access-Control-Allow-Origin: https://www.baidu.com Cache-Control: private, max-age=0, no-store, no-cache, must-revalidate, post-check=0, pre-check=0 Cf-Ray: 88535773eaf5107e-HKG Content-Length: 143 Content-Type: text/html Date: Fri, 17 May 2024 11:42:00 GMT Expires: Thu, 01 Jan 1970 00:00:01 GMT Location: https://liudon.org Server: cloudflare Vary: Accept-Encoding 浏览器报错\nAccess to fetch at 'https://liudon.org/' (redirected from 'https://liudon.xyz/302_return_origin_header') from origin 'https://www.baidu.com' has been blocked by CORS policy: No 'Access-Control-Allow-Origin' header is present on the requested resource. If an opaque response serves your needs, set the request's mode to 'no-cors' to fetch the resource with CORS disabled. 注意，这里302跳转请求没有报错，是跳转后的连接报了跨域错误。\nLocation请求\nGET / HTTP/1.1 Host: liudon.org Origin: null Referer: https://www.baidu.com/ User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36 302返回了跨域头，所以浏览器请求了Location地址。\n但为什么两次请求header头里的Origin字段值不一致呢？第二次Location请求为什么Origin字段值是null？\n第一次： Origin: https://www.baidu.com 第二次 Origin: null 经过一番搜索，终于找到了一些资料。\nThe Origin header value may be null in a number of cases, including (non-exhaustively):\nOrigins whose scheme is not one of http, https, ftp, ws, wss, or gopher (including blob, file and data). Cross-origin images and media data, including that in , and elements. Documents created programmatically using createDocument(), generated from a data: URL, or that do not have a creator browsing context. Redirects across origins. iframes with a sandbox attribute that doesn’t contain the value allow-same-origin. Responses that are network errors. Referrer-Policy set to no-referrer for non-cors request modes (e.g. simple form posts).\n出自 https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Origin#description\nA request request has a redirect-tainted origin if these steps return true:\nLet lastURL be null.\nFor each url of request’s URL list:\nIf lastURL is null, then set lastURL to url and continue.\nIf url’s origin is not same origin with lastURL’s origin and request’s origin is not same origin with lastURL’s origin, then return true.\nSet lastURL to url. Return false. Serializing a request origin, given a request request, is to run these steps:\nIf request has a redirect-tainted origin, then return “null”.\nReturn request’s origin, serialized.\n出自 https://fetch.spec.whatwg.org/#concept-request-tainted-origin\n简单说就是如果302跳转的域与上一次请求域不同的话，就会将Origin设置为null。\n","wordCount":"721","inLanguage":"en","datePublished":"2024-05-17T20:13:57+08:00","dateModified":"2024-05-17T20:13:57+08:00","author":{"@type":"Person","name":"Liudon"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://liudon.com/posts/the-cors-issue-with-302-redirect/"},"publisher":{"@type":"Organization","name":"流动","logo":{"@type":"ImageObject","url":"https://liudon.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://liudon.com/ accesskey=h title="流动 (Alt + H)">流动</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://liudon.com/ title=Home><span>Home</span></a></li><li><a href=https://liudon.com/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://workout.liudon.com title=Workouts><span>Workouts</span>&nbsp;
<svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=https://liudon.com/about/ title=About><span>About</span></a></li><li><a href=https://liudon.com/search/ title="🔍 (Alt + /)" accesskey=/><span>🔍</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">302跳转的跨域问题(CORS)</h1><div class=post-meta><span title='2024-05-17 20:13:57 +0800 +0800'>2024-05-17</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;721 words&nbsp;·&nbsp;Liudon</div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e5%9c%ba%e6%99%af%e4%b8%80302%e4%b8%8d%e8%bf%94%e5%9b%9e%e8%b7%a8%e5%9f%9f%e5%a4%b4 aria-label=场景一：302不返回跨域头>场景一：302不返回跨域头</a></li><li><a href=#%e5%9c%ba%e6%99%af%e4%ba%8c302%e8%b7%b3%e8%bd%ac%e8%bf%94%e5%9b%9e%e8%b7%a8%e5%9f%9f%e5%a4%b4 aria-label=场景二：302跳转返回跨域头>场景二：302跳转返回跨域头</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><p>302跳转的跨域问题</p><h4 id=场景一302不返回跨域头>场景一：302不返回跨域头<a hidden class=anchor aria-hidden=true href=#场景一302不返回跨域头>#</a></h4><p><strong>请求</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>GET /302 HTTP/1.1
</span></span><span style=display:flex><span>Host: liudon.xyz
</span></span><span style=display:flex><span>Origin: https://www.baidu.com
</span></span><span style=display:flex><span>User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36
</span></span></code></pre></div><p><strong>返回</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>HTTP/1.1 200 OK
</span></span><span style=display:flex><span>Cache-Control: private, max-age=0, no-store, no-cache, must-revalidate, post-check=0, pre-check=0
</span></span><span style=display:flex><span>Cf-Ray: 88535773eaf5107e-HKG
</span></span><span style=display:flex><span>Content-Length: 143
</span></span><span style=display:flex><span>Content-Type: text/html
</span></span><span style=display:flex><span>Date: Fri, 17 May 2024 11:42:00 GMT
</span></span><span style=display:flex><span>Expires: Thu, 01 Jan 1970 00:00:01 GMT
</span></span><span style=display:flex><span>Location: https://liudon.org
</span></span><span style=display:flex><span>Server: cloudflare
</span></span><span style=display:flex><span>Vary: Accept-Encoding
</span></span></code></pre></div><p><strong>浏览器报错</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>Access to fetch at &#39;https://liudon.xyz/302&#39; from origin &#39;https://www.baidu.com&#39; has been blocked by CORS policy: No &#39;Access-Control-Allow-Origin&#39; header is present on the requested resource. If an opaque response serves your needs, set the request&#39;s mode to &#39;no-cors&#39; to fetch the resource with CORS disabled.
</span></span></code></pre></div><p><picture><source type=image/avif srcset="https://liudon.com/posts/the-cors-issue-with-302-redirect/302.png_1080x.avif 1080w" sizes="(min-width: 768px) 1080px, 100vw"><source type=image/webp srcset="https://liudon.com/posts/the-cors-issue-with-302-redirect/302.png_1080x.webp 1080w" sizes="(min-width: 768px) 1080px, 100vw"><img src=302.png width=1080 height=124 alt=302 title loading=lazy></picture></p><h4 id=场景二302跳转返回跨域头>场景二：302跳转返回跨域头<a hidden class=anchor aria-hidden=true href=#场景二302跳转返回跨域头>#</a></h4><p><strong>请求</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>GET /302_return_origin_header HTTP/1.1
</span></span><span style=display:flex><span>Host: liudon.xyz
</span></span><span style=display:flex><span>Origin: https://www.baidu.com
</span></span><span style=display:flex><span>User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36
</span></span></code></pre></div><p><strong>返回</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>HTTP/1.1 200 OK
</span></span><span style=display:flex><span>Access-Control-Allow-Origin: https://www.baidu.com
</span></span><span style=display:flex><span>Cache-Control: private, max-age=0, no-store, no-cache, must-revalidate, post-check=0, pre-check=0
</span></span><span style=display:flex><span>Cf-Ray: 88535773eaf5107e-HKG
</span></span><span style=display:flex><span>Content-Length: 143
</span></span><span style=display:flex><span>Content-Type: text/html
</span></span><span style=display:flex><span>Date: Fri, 17 May 2024 11:42:00 GMT
</span></span><span style=display:flex><span>Expires: Thu, 01 Jan 1970 00:00:01 GMT
</span></span><span style=display:flex><span>Location: https://liudon.org
</span></span><span style=display:flex><span>Server: cloudflare
</span></span><span style=display:flex><span>Vary: Accept-Encoding
</span></span></code></pre></div><p><strong>浏览器报错</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>Access to fetch at &#39;https://liudon.org/&#39; (redirected from &#39;https://liudon.xyz/302_return_origin_header&#39;) from origin &#39;https://www.baidu.com&#39; has been blocked by CORS policy: No &#39;Access-Control-Allow-Origin&#39; header is present on the requested resource. If an opaque response serves your needs, set the request&#39;s mode to &#39;no-cors&#39; to fetch the resource with CORS disabled.
</span></span></code></pre></div><p><picture><source type=image/avif srcset="https://liudon.com/posts/the-cors-issue-with-302-redirect/302_return_origin_header.png_1080x.avif 1080w" sizes="(min-width: 768px) 1080px, 100vw"><source type=image/webp srcset="https://liudon.com/posts/the-cors-issue-with-302-redirect/302_return_origin_header.png_1080x.webp 1080w" sizes="(min-width: 768px) 1080px, 100vw"><img src=302_return_origin_header.png width=1080 height=70 alt="302 return origin header" title loading=lazy></picture></p><p>注意，这里302跳转请求没有报错，是跳转后的连接报了跨域错误。</p><p><strong>Location请求</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>GET / HTTP/1.1
</span></span><span style=display:flex><span>Host: liudon.org
</span></span><span style=display:flex><span>Origin: null
</span></span><span style=display:flex><span>Referer: https://www.baidu.com/
</span></span><span style=display:flex><span>User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36
</span></span></code></pre></div><p><picture><source type=image/avif srcset="https://liudon.com/posts/the-cors-issue-with-302-redirect/location.png_1080x.avif 1080w" sizes="(min-width: 768px) 1080px, 100vw"><source type=image/webp srcset="https://liudon.com/posts/the-cors-issue-with-302-redirect/location.png_1080x.webp 1080w" sizes="(min-width: 768px) 1080px, 100vw"><img src=location.png width=1080 height=847 alt=location title loading=lazy></picture></p><p>302返回了跨域头，所以浏览器请求了Location地址。</p><p>但为什么两次请求header头里的<code>Origin</code>字段值不一致呢？第二次Location请求为什么<code>Origin</code>字段值是null？</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>第一次：
</span></span><span style=display:flex><span>Origin: https://www.baidu.com
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>第二次
</span></span><span style=display:flex><span>Origin: null
</span></span></code></pre></div><p>经过一番搜索，终于找到了一些资料。</p><blockquote><p>The Origin header value may be null in a number of cases, including (non-exhaustively):</p><p>Origins whose scheme is not one of http, https, ftp, ws, wss, or gopher (including blob, file and data).
Cross-origin images and media data, including that in , and elements.
Documents created programmatically using createDocument(), generated from a data: URL, or that do not have a creator browsing context.
Redirects across origins.
iframes with a sandbox attribute that doesn&rsquo;t contain the value allow-same-origin.
Responses that are network errors.
Referrer-Policy set to no-referrer for non-cors request modes (e.g. simple form posts).</p></blockquote><p>出自 <a href=https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Origin#description>https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Origin#description</a></p><blockquote><p>A request request has a redirect-tainted origin if these steps return true:</p><p>Let lastURL be null.</p><p>For each url of request’s URL list:</p><p>If lastURL is null, then set lastURL to url and continue.</p><p>If url’s origin is not same origin with lastURL’s origin and request’s origin is not same origin with lastURL’s origin, then return true.</p><p>Set lastURL to url.
Return false.
Serializing a request origin, given a request request, is to run these steps:</p><p>If request has a redirect-tainted origin, then return &ldquo;null&rdquo;.</p><p>Return request’s origin, serialized.</p></blockquote><p>出自 <a href=https://fetch.spec.whatwg.org/#concept-request-tainted-origin>https://fetch.spec.whatwg.org/#concept-request-tainted-origin</a></p><p>简单说就是如果302跳转的域与上一次请求域不同的话，就会将Origin设置为<code>null</code>。</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://liudon.com/tags/cors/>Cors</a></li></ul><nav class=paginav><a class=prev href=https://liudon.com/posts/replacing-cloudflare-ipfs-gateway-with-self-hosted-gateway/><span class=title>« Prev</span><br><span>搭建自托管IPFS Gateway服务，替代Cloudflare的IPFS Gateway</span>
</a><a class=next href=https://liudon.com/posts/gorm-supports-sqlcommenter/><span class=title>Next »</span><br><span>GORM增加sqlcommenter特性</span></a></nav></footer><div><div class=post_ads><ins class=adsbygoogle style=display:block data-ad-client=ca-pub-4739645989170648 data-ad-slot=5019102040 data-ad-format=auto data-full-width-responsive=true></ins><script>window.addEventListener("load",function(){(adsbygoogle=window.adsbygoogle||[]).push({})})</script></div><div class=pagination__title><span class=pagination__title-h style=font-size:20px>💬评论</span><hr></div><div id=tcomment></div><script src=https://cdnjs.cloudflare.com/ajax/libs/twikoo/1.6.41/twikoo.all.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script>twikoo.init({envId:"https://comment.liudon.com",el:"#tcomment",lang:"zh-CN",region:"ap-shanghai",path:window.TWIKOO_MAGIC_PATH||window.location.pathname})</script></div></article></main><footer class=footer><span>&copy; 2025 <a href=https://liudon.com/>流动</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg></a><footer class=footer style=margin-top:-20px;padding-top:0><span><a href=https://beian.miit.gov.cn target=_blank>京ICP备13029522号-2</a></span></footer><script src=//tokinx.github.io/ViewImage/view-image.min.js async></script><script>function initViewImage(){window.ViewImage&&ViewImage.init(".post-content img")}document.readyState==="complete"?initViewImage():window.addEventListener("load",initViewImage)</script><script>const host=window.location.host;host!=="blog.liudon.xyz"&&!host.startsWith("liudon.")&&!host.startsWith("localhost")&&!host.startsWith("127.0.0.1")&&(document.body.innerHTML=['<div style="margin: auto;">',"<h1>当前页面并非本人博客，即将在2秒后跳转到本人博客: https://liudon.com。</h1>","<br />","</div>"].join(""),document.body.style=["background-color: white;","color: black;","text-align: center;","font-size: 50px;","width: 100vw;","height: 100vh;","display: flex;"].join(""),setTimeout(()=>{window.location.href="https://liudon.com"},2e3))</script><script>enScroll=!1,enFdl=!1,extCurrent=0[0],filename=0[0],targetText=0[0],splitOrigin=0[0];const lStor=localStorage,sStor=sessionStorage,doc=document,docEl=document.documentElement,docBody=document.body,docLoc=document.location,w=window,s=screen,nav=navigator||{},extensions=["pdf","xls","xlsx","doc","docx","txt","rtf","csv","exe","key","pps","ppt","pptx","7z","pkg","rar","gz","zip","avi","mov","mp4","mpe","mpeg","wmv","mid","midi","mp3","wav","wma"];function a(e,t,n,o){const j="G-G9ZDJQN9E2",r=()=>Math.floor(Math.random()*1e9)+1,c=()=>Math.floor(Date.now()/1e3),F=()=>(sStor._p||(sStor._p=r()),sStor._p),E=()=>r()+"."+c(),_=()=>(lStor.cid_v4||(lStor.cid_v4=E()),lStor.cid_v4),m=lStor.getItem("cid_v4"),v=()=>m?0[0]:enScroll==!0?0[0]:"1",p=()=>(sStor.sid||(sStor.sid=c()),sStor.sid),O=()=>{if(!sStor._ss)return sStor._ss="1",sStor._ss;if(sStor.getItem("_ss")=="1")return 0[0]},a="1",g=()=>{if(sStor.sct)if(enScroll==!0)return sStor.sct;else x=+sStor.getItem("sct")+ +a,sStor.sct=x;else sStor.sct=a;return sStor.sct},i=docLoc.search,b=new URLSearchParams(i),h=["q","s","search","query","keyword"],y=h.some(e=>i.includes("&"+e+"=")||i.includes("?"+e+"=")),u=()=>y==!0?"view_search_results":enScroll==!0?"scroll":enFdl==!0?"file_download":"page_view",f=()=>enScroll==!0?"90":0[0],C=()=>{if(u()=="view_search_results"){for(let e of b)if(h.includes(e[0]))return e[1]}else return 0[0]},d=encodeURIComponent,k=e=>{let t=[];for(let n in e)e.hasOwnProperty(n)&&e[n]!==0[0]&&t.push(d(n)+"="+d(e[n]));return t.join("&")},A=!1,S="https://liudon.com/analytics/post",M=k({tid:j,_p:F(),v:"2",sr:(s.width*w.devicePixelRatio+"x"+s.height*w.devicePixelRatio).toString(),ul:(nav.language||0[0]).toLowerCase(),cid:_(),_fv:v(),_s:"1",dl:docLoc.origin+docLoc.pathname+i,dt:doc.title||0[0],dr:doc.referrer||0[0],sid:p(),sct:g(),seg:"1",en:u(),"epn.percent_scrolled":f(),"ep.search_term":C(),"ep.file_extension":e||0[0],"ep.file_name":t||0[0],"ep.link_text":n||0[0],"ep.link_url":o||0[0],_ss:O(),_dbg:A?1:0[0]}),l=S+"?"+M;if(nav.sendBeacon)nav.sendBeacon(l);else{let e=new XMLHttpRequest;e.open("POST",l,!0)}}a();function sPr(){return(docEl.scrollTop||docBody.scrollTop)/((docEl.scrollHeight||docBody.scrollHeight)-docEl.clientHeight)*100}doc.addEventListener("scroll",sEv,{passive:!0});function sEv(){const e=sPr();if(e<90)return;enScroll=!0,a(),doc.removeEventListener("scroll",sEv,{passive:!0}),enScroll=!1}document.addEventListener("DOMContentLoaded",function(){let e=document.getElementsByTagName("a");for(let t=0;t<e.length;t++)if(e[t].getAttribute("href")!=null){const n=e[t].getAttribute("href"),s=n.substring(n.lastIndexOf("/")+1),o=s.split(".").pop();(e[t].hasAttribute("download")||extensions.includes(o))&&e[t].addEventListener("click",fDl,{passive:!0})}});function fDl(e){enFdl=!0;const t=e.currentTarget.getAttribute("href"),n=t.substring(t.lastIndexOf("/")+1),s=n.split(".").pop(),o=n.replace("."+s,""),i=e.currentTarget.text,r=t.replace(docLoc.origin,"");a(s,o,i,r),enFdl=!1}</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>